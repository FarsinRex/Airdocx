<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Interactive Image Cropper</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <div class="container">
    <h2>üñºÔ∏è Interactive Image Cropping UI</h2>

    <input type="file" id="upload" accept="image/*" />

    <div id="canvasWrapper">
      <canvas id="canvas" width="800" height="600"></canvas>
      <div id="cropBox"></div>
    </div>

    <div class="info">
      <p><strong>Crop Coordinates:</strong></p>
      <p>X: <span id="x">-</span> | Y: <span id="y">-</span> | Width: <span id="w">-</span> | Height: <span id="h">-</span></p>
      <button id="applyCrop">Apply Crop</button>
    </div>

    <h3>üì∏ Cropped Preview</h3>
    <canvas id="previewCanvas"></canvas>
  </div>

  <script>
    const upload = document.getElementById('upload');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const cropBox = document.getElementById('cropBox');
    const previewCanvas = document.getElementById('previewCanvas');
    const previewCtx = previewCanvas.getContext('2d');

    let image = new Image();
    let isDragging = false;
    let startX, startY, endX, endY;

    upload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(event) {
        image.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    image.onload = () => {
      canvas.width = image.width;
      canvas.height = image.height;
      ctx.drawImage(image, 0, 0);
    };

    function clamp(val, min, max) {
      return Math.max(min, Math.min(val, max));
    }

    canvas.addEventListener('mousedown', e => {
      const rect = canvas.getBoundingClientRect();
      startX = (e.clientX - rect.left) * (canvas.width / rect.width);
      startY = (e.clientY - rect.top) * (canvas.height / rect.height);
      isDragging = true;
    });

    canvas.addEventListener('mousemove', e => {
      if (!isDragging) return;

      const rect = canvas.getBoundingClientRect();
      endX = (e.clientX - rect.left) * (canvas.width / rect.width);
      endY = (e.clientY - rect.top) * (canvas.height / rect.height);

      const x = clamp(Math.min(startX, endX), 0, canvas.width);
      const y = clamp(Math.min(startY, endY), 0, canvas.height);
      const width = clamp(Math.abs(endX - startX), 0, canvas.width - x);
      const height = clamp(Math.abs(endY - startY), 0, canvas.height - y);

      cropBox.style.left = x + 'px';
      cropBox.style.top = y + 'px';
      cropBox.style.width = width + 'px';
      cropBox.style.height = height + 'px';

      document.getElementById('x').textContent = Math.round(x);
      document.getElementById('y').textContent = Math.round(y);
      document.getElementById('w').textContent = Math.round(width);
      document.getElementById('h').textContent = Math.round(height);
    });

    canvas.addEventListener('mouseup', () => {
      isDragging = false;
    });

    document.getElementById('applyCrop').addEventListener('click', () => {
      const box = cropBox.getBoundingClientRect();
      const canvasRect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / canvasRect.width;
      const scaleY = canvas.height / canvasRect.height;

      const cropX = (box.left - canvasRect.left) * scaleX;
      const cropY = (box.top - canvasRect.top) * scaleY;
      const cropW = box.width * scaleX;
      const cropH = box.height * scaleY;

      if (cropW < 5 || cropH < 5) {
        alert("Crop area too small.");
        return;
      }

      previewCanvas.width = cropW;
      previewCanvas.height = cropH;
      previewCtx.clearRect(0, 0, cropW, cropH);
      previewCtx.drawImage(canvas, cropX, cropY, cropW, cropH, 0, 0, cropW, cropH);

      console.log("Cropped Area:", { x: cropX, y: cropY, width: cropW, height: cropH });
    });
  </script>

</body>
</html>
